<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>William Darlington</title>

  <!-- Favicons (root-relative paths + cache-bust) -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32.png?v=6">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16.png?v=6">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png?v=6">
  <link rel="shortcut icon" href="/favicon/favicon-32.png?v=6">
  <!-- optional ICO if you have it -->
  <!-- <link rel="icon" href="/favicon/favicon.ico?v=6"> -->
  <meta name="theme-color" content="#0b0e14" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0e14; --muted:#94a3b8; --text:#e8eefc;
      --brand:#7c3aed; --brand-2:#22d3ee; --ring:rgba(124,58,237,.4);
      --shadow:0 14px 40px rgba(0,0,0,.5); --radius:20px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text); line-height:1.55;
      background:
        radial-gradient(1200px 500px at 120% -10%, rgba(34,211,238,.08), transparent 60%),
        radial-gradient(1000px 500px at -20% 10%, rgba(124,58,237,.09), transparent 60%),
        var(--bg);
    }
    img{max-width:100%;display:block}
    a{color:inherit;text-decoration:none}
    .container{width:min(1200px,92%);margin-inline:auto}

    /* NAV */
    header{position:sticky;top:0;z-index:50;background:rgba(15,21,36,.78);backdrop-filter:saturate(150%) blur(12px);border-bottom:1px solid rgba(255,255,255,.08);cursor:pointer}
    .nav{display:flex;justify-content:flex-end;align-items:center;padding:14px 28px;gap:12px}
    .nav-links{display:flex;gap:12px;flex-wrap:wrap}
    .chip{padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08)}
    .pill{padding:10px 16px;border-radius:14px;background:linear-gradient(135deg,var(--brand),var(--brand-2));font-weight:700;color:#0a0a0a;box-shadow:0 8px 24px var(--ring)}
    /* make header clickable, but nav links ignore header click */
    header a{pointer-events:auto}
    header .nav{pointer-events:none}
    header .nav a{pointer-events:auto}

    /* Sections + HERO */
    section{padding:24px 0 52px}
    .hero{display:grid;grid-template-columns:1fr 1fr;padding:64px 0;gap:32px;align-items:center}
    @media(max-width:900px){.hero{grid-template-columns:1fr;text-align:center}}
    .hero h1{font-size:clamp(32px,5vw,56px);font-weight:800;line-height:1.1;margin-bottom:10px}
    .hero p{color:var(--muted)}
    .hero-card{border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;justify-self:end;max-width:min(520px,90vw)}
    @media(max-width:900px){.hero-card{justify-self:center}}
    .hero-card img{width:100%;height:auto;object-fit:cover}

    /* Views */
    .hidden{display:none}
    .view-head{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:16px;flex-wrap:wrap}
    .view-head h2{font-size:clamp(24px,3vw,34px)}
    .back{padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.14)}

    /* Grids */
    .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px}
    .shot{border-radius:var(--radius);overflow:hidden;background:#111;box-shadow:var(--shadow);cursor:pointer}
    .shot img{width:100%;height:auto}
    .shot.video video{width:100%;height:auto;display:block;background:#000;border:0;outline:0;object-fit:contain} /* no cropping */

    .stream-grid{margin-top:12px}

    .travel-grid{display:grid;gap:20px;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}
    .place{position:relative;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow)}
    .place img,.place video{width:100%;height:100%;object-fit:cover;display:block;background:#000} /* banner style */
    .place .overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.65),rgba(0,0,0,.08) 60%);display:flex;flex-direction:column;justify-content:flex-end;padding:20px}
    .place h4{margin:0 0 6px;font-size:18px}
    .place p{margin:0 0 10px;font-size:14px;color:var(--muted)}
    .place a{align-self:start}

    /* Footer (only socials) */
    footer{padding:28px 0;border-top:1px solid rgba(255,255,255,.08)}
    .footer-center{display:flex;flex-direction:column;align-items:center;gap:10px}
    .social{display:flex;gap:10px}
  </style>
</head>
<body>
<header>
  <div class="nav container">
    <nav class="nav-links">
      <a class="chip" href="#/portfolio">Portfolio</a>
      <a class="chip" href="#/travels">Travel</a>
      <a class="pill" href="https://hdbot.io" target="_blank" rel="noopener">ALGOs</a>
      <a class="chip" href="mailto:hanley.darlington@gmail.com">Contact</a>
    </nav>
  </div>
</header>

<main>
  <!-- HOME -->
  <section id="view-home">
    <div class="container">
      <div class="hero">
        <div>
          <h1>William Darlington</h1>
          <p>Vires in Numeris</p>
        </div>
        <div class="hero-card">
          <img id="heroImg" src="user.png" alt="Profile">
        </div>
      </div>

      <div class="gallery stream-grid" id="streamGrid">
        <p style="color:#9aa7bd">Loading photos…</p>
      </div>
    </div>
  </section>

  <!-- PORTFOLIO -->
  <section id="view-portfolio" class="hidden">
    <div class="container">
      <div class="view-head">
        <h2>Portfolio</h2>
        <a class="back" href="#/">← Home</a>
      </div>
      <div class="gallery" id="portfolioGrid"><p style="color:#9aa7bd">Loading…</p></div>
      <div id="portfolioError"></div>
    </div>
  </section>

  <!-- TRAVEL INDEX -->
  <section id="view-travels" class="hidden">
    <div class="container">
      <div class="view-head">
        <h2>Travel</h2>
        <a class="back" href="#/">← Home</a>
      </div>
      <div class="travel-grid" id="travelCards"><p style="color:#9aa7bd">Loading…</p></div>
      <div id="travelsError"></div>
    </div>
  </section>

  <!-- SINGLE TRAVEL ALBUM -->
  <section id="view-album" class="hidden">
    <div class="container">
      <div class="view-head">
        <h2 id="albumTitle">Album</h2>
        <a class="back" href="#/travels">← All trips</a>
      </div>
      <div class="gallery" id="albumGrid"><p style="color:#9aa7bd">Loading…</p></div>
      <div id="albumError"></div>
    </div>
  </section>
</main>

<footer>
  <div class="container footer-center">
    <div class="social">
      <a class="chip" href="https://www.linkedin.com/in/william-darlington-736475212/" target="_blank" rel="noopener">LinkedIn</a>
      <a class="chip" href="https://instagram.com/wi11.4m" target="_blank" rel="noopener">Insta</a>
    </div>
  </div>
</footer>

<script>
(function(){
  'use strict';

  // ---------- Config ----------
  var GH = { owner:'Hanley-Darlington', repo:'about', ref:'main' };
  var IMG_EXT = ['.jpg','.jpeg','.png','.webp','.gif','.avif'];
  var VIDEO_EXT = ['.mp4','.webm'];
  var TTL = 5*60*1000;

  // Make the WHOLE header (except links) click to Home
  document.querySelector('header').addEventListener('click', function(e){
    if (e.target.closest('a')) return;
    location.hash = '#/';
  });

  function hasExt(name, exts){
    name = (name||'').toLowerCase();
    for (var i=0;i<exts.length;i++){
      var ext = exts[i];
      if (name.indexOf(ext, name.length-ext.length) !== -1) return true;
    }
    return false;
  }
  function isImg(n){ return hasExt(n, IMG_EXT); }
  function isVideo(n){ return hasExt(n, VIDEO_EXT); }
  function isMedia(n){ return isImg(n) || isVideo(n); }

  function cacheGet(k){
    try{
      var raw = localStorage.getItem(k);
      if(!raw) return null;
      var obj = JSON.parse(raw);
      if(Date.now() - obj.t > TTL) return null;
      return obj.data;
    }catch(e){ return null; }
  }
  function cacheSet(k,v){ try{ localStorage.setItem(k, JSON.stringify({t:Date.now(), data:v})); }catch(e){} }

  function gh(path){
    var url = 'https://api.github.com/repos/'+GH.owner+'/'+GH.repo+'/contents/'+encodeURIComponent(path)+'?ref='+encodeURIComponent(GH.ref);
    return fetch(url, {headers:{'Accept':'application/vnd.github+json'}}).then(function(r){
      if(!r.ok){
        return r.json().catch(function(){return {message:''};}).then(function(j){
          throw new Error('GitHub '+r.status+' '+path+' '+(j.message||''));
        });
      }
      return r.json();
    });
  }

  function listDirMedia(dir){
    return gh(dir).then(function(items){
      var out = [];
      for(var i=0;i<items.length;i++){
        var it = items[i];
        if(it.type === 'file' && isMedia(it.name)){
          out.push({
            src: it.download_url,
            alt: it.name,
            path: it.path,
            type: isVideo(it.name) ? 'video' : 'image'
          });
        }
      }
      return out;
    }).catch(function(){ return []; });
  }

  function listPortfolio(){
    var k='p_cache'; var d=cacheGet(k); if(d) return Promise.resolve(d);
    return listDirMedia('portfolio').then(function(v){ cacheSet(k,v); return v; });
  }

  function listTravelAll(){
    var k='t_cache'; var d=cacheGet(k); if(d) return Promise.resolve(d);
    var out=[];
    function rec(dir){
      return gh(dir).then(function(items){
        var chain = Promise.resolve();
        for(var i=0;i<items.length;i++){
          (function(it){
            if(it.type==='file' && isMedia(it.name)){
              out.push({
                src: it.download_url,
                alt: it.name,
                path: it.path,
                type: isVideo(it.name) ? 'video' : 'image'
              });
            }else if(it.type==='dir'){
              chain = chain.then(function(){ return rec(it.path); });
            }
          })(items[i]);
        }
        return chain;
      }).catch(function(){});
    }
    return rec('travels').then(function(){ cacheSet(k,out); return out; });
  }

  function listAlbum(folder){
    return listDirMedia('travels/'+folder);
  }

  function heroFromProfile(){
    return listDirMedia('profile').then(function(pics){
      for (var i=0;i<pics.length;i++) if (pics[i].type==='image') return pics[i].src;
      return (pics[0] && pics[0].src) || 'user.png';
    }).catch(function(){ return 'user.png'; });
  }

  // ---------- DOM helpers ----------
  function byId(id){ return document.getElementById(id); }
  function clear(el){ while(el.firstChild) el.removeChild(el.firstChild); }

  function makeVideo(src){
    var v = document.createElement('video');
    v.src = src;
    v.muted = true;
    v.loop = true;
    v.autoplay = true;
    v.playsInline = true;
    v.preload = 'metadata';
    v.controls = false;
    return v;
  }

  function mountGrid(elId, files, onClick){
    var el = byId(elId); clear(el);
    if(!files.length){
      var p = document.createElement('p'); p.style.color='#9aa7bd'; p.appendChild(document.createTextNode('Nothing here yet.'));
      el.appendChild(p); return;
    }
    for(var i=0;i<files.length;i++){
      (function(f){
        var fig = document.createElement('figure'); fig.className='shot';
        if (f.type === 'video'){
          fig.className += ' video';
          var v = makeVideo(f.src);
          if(onClick){ fig.addEventListener('click', function(){ onClick(f); }); }
          fig.appendChild(v);
        } else {
          var img = new Image(); img.src=f.src; img.alt=f.alt; img.loading='lazy'; img.decoding='async';
          if(onClick){ img.addEventListener('click', function(){ onClick(f); }); }
          fig.appendChild(img);
        }
        el.appendChild(fig);
      })(files[i]);
    }
  }

  function err(elId, msg){
    var el = byId(elId); if(!el) return;
    var chip = document.createElement('div');
    chip.className='chip';
    chip.style.borderColor='#ff8a8a'; chip.style.background='rgba(255,0,0,.12)'; chip.style.color='#ffdede';
    chip.appendChild(document.createTextNode(msg));
    clear(el); el.appendChild(chip);
  }

  // ---------- Router ----------
  var views = {
    home: byId('view-home'),
    portfolio: byId('view-portfolio'),
    travels: byId('view-travels'),
    album: byId('view-album')
  };

  function show(name){
    for(var k in views){ if(views.hasOwnProperty(k)) views[k].classList.add('hidden'); }
    views[name].classList.remove('hidden');
    window.scrollTo(0,0);
  }

  function route(){
    var h = (location.hash||'').replace(/^#/, '');

    if(h.indexOf('/portfolio') === 0){
      show('portfolio');
      listPortfolio().then(function(list){
        mountGrid('portfolioGrid', list, null);
      }).catch(function(e){ err('portfolioError', e.message); });
      return;
    }

    if(h.indexOf('/travels') === 0){
      show('travels');
      listTravelAll().then(function(all){
        var groups = {};
        for(var i=0;i<all.length;i++){
          var pth = all[i].path;
          var m = /^travels\/([^\/]+)\//.exec(pth);
          var key = m ? decodeURIComponent(m[1]) : 'trip';
          (groups[key]||(groups[key]=[])).push(all[i]);
        }
        var wrap = byId('travelCards'); clear(wrap);
        for(var folder in groups){
          if(!groups.hasOwnProperty(folder)) continue;
          var files = groups[folder];
          var card = document.createElement('article'); card.className='place';

          // banner preview = first media (video preferred)
          if (files[0].type === 'video'){
            card.appendChild(makeVideo(files[0].src));
          } else {
            var img = new Image(); img.src = files[0].src; img.alt = folder; img.loading='lazy';
            card.appendChild(img);
          }

          var ov = document.createElement('div'); ov.className='overlay';
          var h4 = document.createElement('h4'); h4.appendChild(document.createTextNode(folder.replace(/[-_]/g,' ')));
          var p2 = document.createElement('p'); p2.appendChild(document.createTextNode(files.length+' file'+(files.length>1?'s':'')));
          var a = document.createElement('a'); a.className='chip'; a.href = '#/travel/'+encodeURIComponent(folder); a.appendChild(document.createTextNode('View shots'));
          ov.appendChild(h4); ov.appendChild(p2); ov.appendChild(a);
          card.appendChild(ov);
          wrap.appendChild(card);
        }
      }).catch(function(e){ err('travelsError', e.message); });
      return;
    }

    if(h.indexOf('/travel/') === 0){
      var parts = h.split('/');
      var folder = decodeURIComponent(parts[2]||'').trim();
      show('album'); byId('albumTitle').textContent = folder.replace(/[-_]/g,' ');
      listAlbum(folder).then(function(list){ mountGrid('albumGrid', list, null); })
        .catch(function(e){ err('albumError', e.message); });
      return;
    }

    // HOME
    show('home');
    Promise.all([listPortfolio(), listTravelAll()]).then(function(arr){
      var p = arr[0], t = arr[1];
      var P = [], T = [], i;
      for(i=0;i<p.length;i++){ P.push({ src:p[i].src, alt:p[i].alt, kind:'portfolio', type:p[i].type }); }
      for(i=0;i<t.length;i++){
        var m = /^travels\/([^\/]+)\//.exec(t[i].path);
        T.push({ src:t[i].src, alt:t[i].alt, kind:'travel', folder:m?decodeURIComponent(m[1]):'trip', type:t[i].type });
      }
      var all = P.concat(T);
      for(i=all.length-1;i>0;i--){ var j=Math.floor(Math.random()*(i+1)); var tmp=all[i]; all[i]=all[j]; all[j]=tmp; }
      var pick = all.slice(0, Math.min(12, all.length));
      mountGrid('streamGrid', pick, function(file){
        if(file.kind==='portfolio'){ location.hash = '#/portfolio'; }
        else{ location.hash = '#/travel/'+encodeURIComponent(file.folder); }
      });
    }).catch(function(e){
      var el = byId('streamGrid'); clear(el);
      var d = document.createElement('div'); d.className='chip';
      d.style.borderColor='#ff8a8a'; d.style.background='rgba(255,0,0,.12)'; d.style.color='#ffdede';
      d.appendChild(document.createTextNode(e.message));
      el.appendChild(d);
    });
  }

  window.addEventListener('hashchange', route);

  // Init
  heroFromProfile().then(function(src){ byId('heroImg').src = src; }).catch(function(){});
  route();
})();
</script>
</body>
</html>
